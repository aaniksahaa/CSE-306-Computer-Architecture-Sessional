
/*
	A1_Group1
	8 February, 2024
*/

#include <avr/io.h>
#define F_CPU 1000000
#include <util/delay.h>

// the following instructions array holding binary machine codes is calculated from a python codebase
// after parsing the given assembly file
// The ATmega for INS_MEM must be burnt every time this array changes due to an alteration in the assembly file

unsigned int instructions[256]=

{ 0xB023, 0xB035, 0xF231, 0xF134, 0xB452, 0x4323, 0x5222, 0x1441, 0x2241, 0xA230, 0x0441, 0x6422, 0x8241, 0xC153, 0xA200, 0x1661, 0x4610, 0x1661, 0x4630, 0xE115, 0x6610, 0xB661, 0x7336, 0x1661, 0x6372, 0x4670, 0x6630, 0xB661, 0x3333, 0x6630, 0xB661, 0xA230, 0x9131, 0x1113, 0xA0F0, 0xF001, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 }

;


int main(void)
{
	DDRA=0b11111111;	// all A pins configured as output
	DDRB=0b00000000;	// all B pins configured as input
	DDRC=0b11111111;	// all C pins configured as output
	DDRD=0b11111111;	// all D pins configured as output
	
	// JTAG is being enabled so that C pins may be used for general IO correctly
	
	MCUCSR|=(1<<JTD);
	MCUCSR|=(1<<JTD);	// JTAG needs to be enabled twice
	
	unsigned int current_PC = 0x00;
	
	while (1) {
		unsigned char c ;
		
		// extracting current PC from PINB
		current_PC = PINB;
		
		unsigned int instruction = instructions[current_PC];
		c = (instruction%(1<<8))&(0xFF);
		
		// transmitting lower 8 bits of instruction to PORTA
		PORTA = c;
		
		// transmitting upper 8 bits of instruction to PORTA
		c = (instruction>>8)&(0xFF);
		PORTC = c;
		
		
		_delay_ms(25);
	}
}